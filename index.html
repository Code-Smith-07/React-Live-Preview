<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Live Preview | Pro Editor</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- CodeMirror 5 (The Engine for the IDE look) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/jsx/jsx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>
    
    <style>
        /* * ðŸŽ¨ GLOBAL VARIABLES & GLASSMORPHISM */
        :root {
            --glass-bg: rgba(20, 20, 30, 0.6);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
            --accent-color: #3b82f6;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: url('https://res.cloudinary.com/ds4uqa17r/image/upload/v1743117225/refined-round-disk_unc21k.png') no-repeat center center fixed;
            background-size: cover;
            background-color: #0f172a;
            color: #ffffff;
            overflow: hidden; /* App-like feel */
        }

        .layout-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            height: 100vh;
            gap: 20px;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Glass Panels */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: var(--glass-shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        /* Header Bar */
        .panel-header {
            height: 50px;
            padding: 0 20px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }

        .panel-title {
            font-weight: 600;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: 0.5px;
        }

        /* --- CODEMIRROR OVERRIDES FOR GLASSY LOOK --- */
        .editor-wrapper {
            flex: 1;
            position: relative;
            overflow: hidden;
            border-radius: 0 0 20px 20px;
        }

        .CodeMirror {
            height: 100% !important;
            background: transparent !important; /* Make transparent to show glass */
            font-family: 'JetBrains Mono', 'Fira Code', Consolas, monospace !important;
            font-size: 14px;
            line-height: 1.6;
            color: #e2e8f0;
        }

        /* Transparent Gutter (Line Numbers) */
        .CodeMirror-gutters {
            background: rgba(0, 0, 0, 0.2) !important;
            border-right: 1px solid rgba(255, 255, 255, 0.05) !important;
        }

        .CodeMirror-linenumber {
            color: #64748b !important;
        }
        
        /* Cursor Color */
        .CodeMirror-cursor {
            border-left: 2px solid #3b82f6 !important;
        }

        /* Selected Text */
        .CodeMirror-selected {
            background: rgba(59, 130, 246, 0.3) !important;
        }

        /* Scrollbars */
        .CodeMirror-scroll::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        .CodeMirror-scroll::-webkit-scrollbar-track {
            background: transparent;
        }
        .CodeMirror-scroll::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
        .CodeMirror-scroll::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* --- PREVIEW FRAME --- */
        iframe#preview-frame {
            width: 100%;
            height: 100%;
            border: none;
            background: #000;
            border-radius: 0 0 20px 20px;
        }

        /* --- UI ELEMENTS --- */
        .status-badge {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            color: #94a3b8;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        .status-badge.active {
            background: rgba(16, 185, 129, 0.15);
            color: #34d399;
            border-color: rgba(16, 185, 129, 0.3);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.1);
        }

        .btn-glass {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #cbd5e1;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .btn-glass:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        .btn-glass.active {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.4);
            color: #60a5fa;
        }

        /* Toggle Switch for Word Wrap */
        .toggle-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
            color: #94a3b8;
            cursor: pointer;
        }
        .toggle-switch {
            width: 28px;
            height: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            position: relative;
            transition: 0.3s;
        }
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 12px;
            height: 12px;
            background: #94a3b8;
            border-radius: 50%;
            transition: 0.3s;
        }
        input[type="checkbox"]:checked + .toggle-switch {
            background: rgba(59, 130, 246, 0.3);
        }
        input[type="checkbox"]:checked + .toggle-switch::after {
            transform: translateX(12px);
            background: #60a5fa;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .layout-container {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr 1fr;
                padding: 10px;
                gap: 10px;
            }
            body { overflow: auto; }
            .CodeMirror { font-size: 12px; }
        }

        /* Mac-like dots */
        .window-controls { display: flex; gap: 6px; }
        .control-dot { width: 10px; height: 10px; border-radius: 50%; }
        .dot-red { background: #ff5f56; }
        .dot-yellow { background: #ffbd2e; }
        .dot-green { background: #27c93f; }
    </style>
</head>
<body>

    <div class="layout-container">
        
        <!-- LEFT PANEL: React Editor -->
        <div class="glass-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <div class="window-controls">
                        <div class="control-dot dot-red"></div>
                        <div class="control-dot dot-yellow"></div>
                        <div class="control-dot dot-green"></div>
                    </div>
                    <span>App.jsx</span>
                </div>
                
                <div style="display: flex; gap: 15px; align-items: center;">
                    <!-- Word Wrap Toggle -->
                    <label class="toggle-wrapper" title="Toggle Word Wrap">
                        <span>Wrap</span>
                        <input type="checkbox" id="wrap-toggle" style="display:none;">
                        <div class="toggle-switch"></div>
                    </label>
                    <div id="status" class="status-badge">Ready</div>
                </div>
            </div>
            
            <div class="editor-wrapper">
                <textarea id="code-input"></textarea>
            </div>
        </div>

        <!-- RIGHT PANEL: Live Preview -->
        <div class="glass-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                    <span>Live Preview</span>
                </div>
                <button onclick="refreshPreview()" class="btn-glass">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg>
                    Refresh
                </button>
            </div>
            <div style="flex: 1; background: #000; position: relative;">
                <iframe id="preview-frame" sandbox="allow-scripts allow-same-origin allow-modals allow-forms"></iframe>
            </div>
        </div>

    </div>

    <!-- ðŸ§  LOGIC -->
    <script>
        const previewFrame = document.getElementById('preview-frame');
        const statusBadge = document.getElementById('status');
        const wrapToggle = document.getElementById('wrap-toggle');
        let debounceTimer;

        // 1. Initialize CodeMirror (VS Code-like Editor)
        const editor = CodeMirror.fromTextArea(document.getElementById('code-input'), {
            mode: "jsx",
            theme: "dracula",
            lineNumbers: true,
            autoCloseBrackets: true,
            matchBrackets: true,
            indentUnit: 2,
            tabSize: 2,
            lineWrapping: false, // Default off
            scrollbarStyle: "native"
        });

        // 2. Default Code (with React & Lucide icons)
        const defaultCode = `import React, { useState } from 'react';
import { Terminal, Play, Shield, Activity } from 'lucide-react';

export default function App() {
  const [logs, setLogs] = useState(["System initialized..."]);

  const addLog = () => {
    const msgs = ["Connecting...", "Encrypting...", "Handshake OK", "Data received"];
    const randomMsg = msgs[Math.floor(Math.random() * msgs.length)];
    setLogs(prev => [...prev, \`[\${new Date().toLocaleTimeString()}] \${randomMsg}\`]);
  };

  return (
    <div className="min-h-screen bg-black text-green-400 font-mono p-8 selection:bg-green-900">
      <div className="max-w-md mx-auto border border-green-800 rounded-lg overflow-hidden shadow-[0_0_20px_rgba(74,222,128,0.2)]">
        
        {/* Header */}
        <div className="bg-green-950/30 p-3 border-b border-green-800 flex items-center justify-between">
          <div className="flex items-center gap-2">
            <Terminal size={16} />
            <span className="text-xs font-bold tracking-widest">SECURE_SHELL</span>
          </div>
          <div className="flex gap-1">
             <div className="w-2 h-2 rounded-full bg-red-500"></div>
             <div className="w-2 h-2 rounded-full bg-yellow-500"></div>
             <div className="w-2 h-2 rounded-full bg-green-500"></div>
          </div>
        </div>

        {/* Body */}
        <div className="p-4 h-64 overflow-y-auto space-y-2 text-sm bg-black/50">
          {logs.map((log, i) => (
            <div key={i} className="opacity-0 animate-[fadeIn_0.3s_ease-out_forwards]">
              <span className="text-green-700 mr-2">$</span>
              {log}
            </div>
          ))}
          <div className="animate-pulse">_</div>
        </div>

        {/* Controls */}
        <div className="p-4 border-t border-green-800 bg-green-950/20 flex gap-2">
          <button 
            onClick={addLog}
            className="flex-1 bg-green-900/40 hover:bg-green-800/60 text-green-300 py-2 rounded text-xs font-bold border border-green-700/50 transition-all flex items-center justify-center gap-2 group"
          >
            <Play size={14} className="group-hover:text-white transition-colors"/> 
            EXECUTE
          </button>
          <button 
            onClick={() => setLogs([])}
            className="px-3 border border-green-800 rounded text-green-600 hover:text-red-400 hover:border-red-900 hover:bg-red-950/30 transition-all"
          >
            <Activity size={14} />
          </button>
        </div>

      </div>
    </div>
  );
}`;

        // Set initial code
        editor.setValue(defaultCode.trim());

        // 3. Word Wrap Logic
        wrapToggle.addEventListener('change', (e) => {
            editor.setOption("lineWrapping", e.target.checked);
        });

        // 4. Update Preview Logic
        function updatePreview() {
            statusBadge.innerText = "Building...";
            statusBadge.className = "status-badge";

            const rawCode = editor.getValue();
            let processedCode = rawCode;
            let componentName = "App";

            // Find component name
            const exportFnMatch = rawCode.match(/export\s+default\s+function\s+(\w+)/);
            if (exportFnMatch) {
                componentName = exportFnMatch[1];
                processedCode = rawCode.replace(/export\s+default\s+function/, 'function');
            } else {
                processedCode = rawCode.replace(/export\s+default/, '');
            }

            // Check imports
            const hasReactImport = /import\s+.*?from\s+['"]react['"]/.test(rawCode);
            const reactImport = hasReactImport ? '' : 'import React, { useState, useEffect } from "react";\n';

            const htmlContent = [
                '<!DOCTYPE html>',
                '<html>',
                '<head>',
                '<meta charset="UTF-8">',
                '<meta name="viewport" content="width=device-width, initial-scale=1.0">',
                '<script src="https://cdn.tailwindcss.com"></' + 'script>',
                // Custom animations for the terminal demo
                '<style>',
                '@keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }',
                'body::-webkit-scrollbar { width: 0; } #root { min-height: 100vh; }',
                '</style>',
                
                // Import Map
                '<script type="importmap">',
                '{ "imports": { ',
                '   "react": "https://esm.sh/react@18.2.0?dev", ',
                '   "react-dom/client": "https://esm.sh/react-dom@18.2.0/client?dev", ',
                '   "lucide-react": "https://esm.sh/lucide-react@0.263.1?external=react,react-dom" ',
                '} }',
                '</' + 'script>',
                
                // Babel
                '<script src="https://unpkg.com/@babel/standalone/babel.min.js"></' + 'script>',
                '</head>',
                '<body>',
                '<div id="root"></div>',
                
                // Error Handler
                '<script>',
                'window.onerror = function(msg, url, line, col, error) {',
                '   document.body.innerHTML = `<div style="color:#ff5f56; background:#1a0000; padding:20px; font-family:monospace; height:100vh; box-sizing:border-box;">',
                '   <h3 style="margin-top:0">Runtime Error</h3>',
                '   <strong>` + msg + `</strong><br/>Line: ` + line;',
                '   </div>`;',
                '};',
                '</' + 'script>',

                // Execution
                '<script type="text/babel" data-type="module" data-presets="react">',
                'import { createRoot as __createRoot } from "react-dom/client";',
                reactImport,
                processedCode,
                'try {',
                '   const root = __createRoot(document.getElementById("root"));',
                '   if (typeof ' + componentName + ' !== "undefined") {',
                '       root.render(<' + componentName + ' />);',
                '   } else if (typeof App !== "undefined") {',
                '       root.render(<App />);',
                '   } else {',
                '       throw new Error("Could not find component. Please export default function App() {}");',
                '   }',
                '} catch (err) {',
                '   console.error(err);',
                '   document.body.innerHTML = `<div style="color:#ff5f56; padding:20px;">Mount Error: ` + err.message + `</div>`;',
                '}',
                '</' + 'script>',
                '</body></html>'
            ].join('\n');

            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            previewFrame.src = url;

            setTimeout(() => {
                statusBadge.innerText = "Live";
                statusBadge.className = "status-badge active";
            }, 800);
        }

        // 5. Typing Event Listener
        editor.on('change', () => {
            statusBadge.innerText = "Typing...";
            statusBadge.className = "status-badge";
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(updatePreview, 1000);
        });

        function refreshPreview() {
            updatePreview();
        }

        // Initial Load
        window.addEventListener('load', updatePreview);

    </script>
</body>
</html>